<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OMAX 1530 Maintenance Tracker</title>

  <link rel="icon" type="image/svg+xml" href="assets/candmlogo.svg" />
  <link rel="alternate icon" href="assets/candmlogo.svg" />

  <!-- Your stylesheet -->
  <link rel="stylesheet" href="style.css" />

</head>
<body>
  <!-- Firebase SDKs (v8 CDN for static sites) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script>/* prevent bfcache for easier debug refresh */ window.onpageshow = e=>{ if(e.persisted) location.reload(); };</script>

  <!-- Firebase project config (correct values) -->
  <script>
    window.FIREBASE_CONFIG = {
      apiKey: "AIzaSyDhUtEx4uvUN_CssllXlm5f3dE8-MTqei0",
      authDomain: "omax-maintenance.firebaseapp.com",
      projectId: "omax-maintenance",
      storageBucket: "omax-maintenance.appspot.com",
      messagingSenderId: "496764208080",
      appId: "1:496764208080:web:43cdd192e462844f7b5335"
    };
  </script>

  <header>
    <div class="header-bar">
      <h1><span class="brand-emblem">OMAX</span> 1530 Maintenance Tracker</h1>
      <div class="header-brand">
        <span class="header-motto">&ldquo;TRY HARDER SUCK LESS&rdquo;</span>
        <img
          class="header-logo"
          src="assets/candmlogo.svg"
          alt="C &amp; M Concrete Precast and Construction logo"
        />
      </div>
      <div class="header-actions">
        <div class="dashboard-settings" id="dashboardSettings">
          <button type="button" class="dashboard-settings-btn" id="dashboardSettingsToggle" aria-haspopup="true" aria-expanded="false" aria-controls="dashboardSettingsMenu" aria-label="Workspace settings" title="Workspace settings">
            <span aria-hidden="true">âš™</span>
          </button>
          <div class="dashboard-settings-menu" id="dashboardSettingsMenu" role="menu" hidden>
            <div class="dashboard-settings-section" data-app-settings-context="dashboard">
              <button type="button" class="dashboard-settings-item" id="dashboardConfigLaunch" role="menuitem" data-settings-focus>Configuration</button>
              <button type="button" class="dashboard-settings-item" id="dashboardEditToggle" role="menuitemcheckbox" aria-checked="false" aria-pressed="false" data-settings-focus>Edit dashboard layout</button>
            </div>
            <div class="dashboard-settings-section" data-app-settings-context="costs">
              <button type="button" class="dashboard-settings-item" id="costTrainerLaunch" role="menuitem" data-settings-focus>Launch cost guided tour</button>
              <button type="button" class="dashboard-settings-item" id="costEditToggle" role="menuitemcheckbox" aria-checked="false" aria-pressed="false">Edit cost layout</button>
            </div>
            <div class="dashboard-settings-section" data-app-settings-context="jobs">
              <button type="button" class="dashboard-settings-item" id="jobEditToggle" role="menuitemcheckbox" aria-checked="false" aria-pressed="false">Edit cutting jobs layout</button>
            </div>
            <a href="#/deleted" class="dashboard-settings-item" role="menuitem" data-settings-nav>ðŸ—‘ Deleted items</a>
            <div class="dashboard-settings-separator" role="separator"></div>
            <button type="button" class="dashboard-settings-item dashboard-settings-item-danger" id="btnClearAllData" data-clear-all="1" role="menuitem" title="Reset all maintenance data">ðŸ§¹ Clear All Data</button>
          </div>
        </div>
      </div>
    </div>
    <nav class="nav">
      <a href="#dashboard"  id="tab-dashboard"  class="active">Dashboard</a>
      <a href="#settings"   id="tab-settings">Maintenance Settings</a>
      <a href="#costs"      id="tab-costs">Cost Analysis</a>
      <a href="#inventory"  id="tab-inventory">Inventory</a>
      <a href="#order-request" id="tab-order">Order Request</a>
      <a href="#jobs"       id="tab-jobs">Cutting Jobs</a>
    </nav>
  </header>

  <div class="dashboard-edit-popup" id="dashboardEditPopup" hidden aria-hidden="true">
    <div class="dashboard-edit-popup-card" role="alert">
      <p class="dashboard-edit-popup-text">Dashboard layout editing is active.</p>
      <button type="button" class="dashboard-edit-popup-button" id="dashboardEditPopupButton">Done and Save</button>
    </div>
  </div>

  <div class="dashboard-edit-popup" id="costEditPopup" hidden aria-hidden="true">
    <div class="dashboard-edit-popup-card" role="alert">
      <p class="dashboard-edit-popup-text">Cost layout editing is active.</p>
      <button type="button" class="dashboard-edit-popup-button" id="costEditPopupButton">Done and Save</button>
    </div>
  </div>

  <div class="dashboard-edit-popup" id="jobEditPopup" hidden aria-hidden="true">
    <div class="dashboard-edit-popup-card" role="alert">
      <p class="dashboard-edit-popup-text">Cutting jobs layout editing is active.</p>
      <button type="button" class="dashboard-edit-popup-button" id="jobEditPopupButton">Done and Save</button>
    </div>
  </div>

  <main id="content"></main>

  <footer>
    <small>Cloud sync via Firestore. Scheduling hours/day is configurable.</small>
  </footer>

  <!-- Lightweight in-app debug (no console required). Open with ?debug=1 -->
  <div id="debugPanel" style="display:none; border:1px dashed #99b; border-radius:10px; margin:12px 8px; padding:10px; background:#f6f8ff">
    <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px">
      <strong>Debug Panel</strong>
      <button type="button" id="dbgRefreshCloud">Refresh Cloud Doc</button>
      <button type="button" id="dbgRefreshSnapshot">Show Local Snapshot</button>
      <span id="dbgInfo" style="margin-left:auto; color:#445">WORKSPACE: <code id="dbgWs"></code></span>
    </div>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px">
      <div>
        <div style="font-weight:600; margin-bottom:4px">Cloud (workspaces/&lt;WORKSPACE_ID&gt;)</div>
        <textarea id="dbgCloud" style="width:100%; height:260px; font-family:ui-monospace, SFMono-Regular, Menlo, monospace"></textarea>
      </div>
      <div>
        <div style="font-weight:600; margin-bottom:4px">Local snapshotState()</div>
        <textarea id="dbgSnap" style="width:100%; height:260px; font-family:ui-monospace, SFMono-Regular, Menlo, monospace"></textarea>
      </div>
    </div>
    <small style="color:#556">Tip: add, edit, or complete a task/job; press <em>Show Local Snapshot</em> to verify it will be saved; then <em>Refresh Cloud Doc</em> to confirm it is stored.</small>
  </div>

  <!-- Auth toolbar + modal (NEW) -->
  <div id="authBar" class="auth-bar">
    <span id="authStatus">Not signed in</span>
    <button id="btnSignIn" class="auth-button auth-button-primary">Sign In</button>
    <button id="btnSignOut" class="auth-button auth-button-secondary" style="display:none;">Sign Out</button>
  </div>

  <div id="authModal" class="auth-modal-backdrop" style="display:none;">
    <div class="auth-modal-dialog">
      <h3>Sign in to workspace</h3>
      <p>Use the same email on all devices to see the same shared data.</p>
      <form id="authForm" class="auth-form">
        <input id="authEmail" type="email" placeholder="you@example.com" required />
        <input id="authPass" type="password" placeholder="Password" required />
        <button type="submit" class="auth-button auth-button-primary">Sign In</button>
        <button type="button" id="authClose" class="auth-button auth-button-secondary">Cancel</button>
      </form>
      <small class="auth-modal-hint">First time with an email? The account will be created automatically.</small>
    </div>
  </div>

  <div id="configModal" class="config-modal" hidden aria-hidden="true">
    <div class="config-dialog" role="dialog" aria-modal="true" aria-labelledby="configTitle">
      <h3 id="configTitle">Workspace configuration</h3>
      <p class="config-description">Tune scheduling defaults for cutting work.</p>
      <form id="configForm" class="config-form">
        <label class="config-field" for="configDailyHours">
          <span class="config-label">Daily cutting hours</span>
          <input type="number" id="configDailyHours" name="configDailyHours" min="0.25" max="24" step="0.25" required />
          <small class="config-help">Updates every calculation that uses hours/day.</small>
        </label>
        <label class="config-toggle" for="configExcludeWeekends">
          <input type="checkbox" id="configExcludeWeekends" name="configExcludeWeekends" />
          <span>Ignore weekends in scheduling</span>
        </label>
        <p class="config-note">Weekend work counts as bonus time when ignored.</p>
        <div class="config-actions">
          <button type="submit" class="config-button config-button-primary" id="configSave">Save changes</button>
          <button type="button" class="config-button config-button-secondary" id="configCancel">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Your app code (split into focused modules; order matters) -->
  <script src="js/core.js"></script>
  <script src="js/computations.js"></script>
  <script src="js/opportunity.js"></script>
  <script src="js/pump.js"></script>
  <script src="js/calendar.js"></script>
  <script src="js/views.js"></script>
  <script src="js/renderers.js"></script>
  <script src="js/trainer.js"></script>
  <script src="js/router.js"></script>
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
</body>
</html>
